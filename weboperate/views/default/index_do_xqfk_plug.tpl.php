<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>eFAST365 产品建议</title>
<style>
/*reset*/
body,div,p,h1,h2,h3,h4,h5,h6,a,ul,li,ol,span,img,input,marquee{ margin:0; padding:0;font-family: "Microsoft YaHei","微软雅黑","Arial","宋体","Times New Roman",Times,serif;}
li{ list-style:none;}
a,a:hover,a:focus,a:active{ text-decoration:none;}
input,img{ border:none;}

.feedback{}
.feedback .top{}
.feedback .top img{ width:100%; max-height:180px;}
.feedback .main{ width:1082px; margin:5px auto 0; overflow:hidden;}
.feedback .main li{ float:left; margin:10px;}
.feedback .main li a{ display:block; padding:28px 0 18px; width:158px; text-align:center; background:#f5f5f5; border:1px solid #ddd; border-radius:3px;}
.feedback .main li a .icon{ display:inline-block; width:62px; height:62px;}
.feedback .main li.wldd a .icon{ background:url(assets/img/item_icon_01.png) no-repeat center 0;}
.feedback .main li.wlfx a .icon{ background:url(assets/img/item_icon_02.png) no-repeat center 0;}
.feedback .main li.pfh a .icon{ background:url(assets/img/item_icon_03.png) no-repeat center 0;}
.feedback .main li.jxc a .icon{ background:url(assets/img/item_icon_04.png) no-repeat center 0;}
.feedback .main li.cw a .icon{ background:url(assets/img/item_icon_05.png) no-repeat center 0;}
.feedback .main li.yy a .icon{ background:url(assets/img/item_icon_06.png) no-repeat center 0;}
.feedback .main li.bb a .icon{ background:url(assets/img/item_icon_07.png) no-repeat center 0;}
.feedback .main li.sp a .icon{ background:url(assets/img/item_icon_08.png) no-repeat center 0;}
.feedback .main li.jcsj a .icon{ background:url(assets/img/item_icon_09.png) no-repeat center 0;}
.feedback .main li.xtgl a .icon{ background:url(assets/img/item_icon_10.png) no-repeat center 0;}
.feedback .main li.xtjc a .icon{ background:url(assets/img/item_icon_11.png) no-repeat center 0;}
.feedback .main li.zzfw a .icon{ background:url(assets/img/item_icon_12.png) no-repeat center 0;}
.feedback .main li.jy a .icon{ background:url(assets/img/item_icon_13.png) no-repeat center 0;}
.feedback .main li a p{ padding-top:25px; color:#666;}
.feedback .main li a:hover,
.feedback .main li a.curr{ background:#fff6f3; border-color:#ec6d3a;}
.feedback .main li a:hover .icon,
.feedback .main li a.curr .icon{ background-position:center -180px;}

.pop_wrap{ width:100%; height:100%; position:absolute; left:0; top:0; background:url(assets/img/pop_wrap_bg.png); display:none;}
.pop_wrap .pop{ max-width:500px; min-height:341px; background:#FFF; position:absolute; left:50%; top:50%; margin-left:-215px; margin-top:-170px; border-radius:5px;}
.pop_wrap .pop .title{ padding:8px 20px; border-bottom:1px solid #d6d6d6;}
.pop_wrap .pop .title i{ float:right; font-style:normal; font-size:22px; color:#999; line-height:20px; cursor:pointer;}
.pop_wrap .pop .title i:hover{ color:#666;}
.pop_wrap .pop form{ padding:15px 20px 5px; overflow:auto;}
.pop_wrap .pop form>p{padding-bottom:8px;}
.pop_wrap .pop form>p label{ display:inline-block; width:90px; height:28px; line-height:22px; vertical-align:top; color:#666; font-size:16px;}
.pop_wrap .pop form .kjfk select{ width:292px; height:26px; border:1px solid #c6c6c6; border-radius:3px;color:#666;}
.pop_wrap .pop form .kjfk input{ width:299px; height:26px; border:1px solid #c6c6c6; border-radius:3px;color:#666; padding-left: 5px}
.pop_wrap .pop form .fkyj textarea{ width:297px; height:95px; border:1px solid #c6c6c6; border-radius:3px; max-width:302px; max-height:95px; color:#666; padding-left: 5px}
.pop_wrap .pop form .tjft .cont_wrap{ display: inline-block; width: 320px; max-height: 233px; overflow: auto;}
.pop_wrap .pop form .tjft .cont_wrap span.cont{ display:inline-block; width:68px; height:68px; border:1px solid #dddddd; border-radius:3px; vertical-align:top; margin-right:5px; position:relative; margin-bottom:5px;}
.pop_wrap .pop form .tjft .cont_wrap span.cont img{ width:100%; height:100%;}
.pop_wrap .pop form .tjft .cont_wrap span.cont i{ width:36px; height:23px; position:absolute; top:-1px; right:-1px; background:url(assets/img/del.png) no-repeat; display:none; cursor:pointer;}
.pop_wrap .pop form .tjft .cont_wrap span.cont:hover{ border-color:#ec6d3a;}
.pop_wrap .pop form .tjft .cont_wrap span.cont:hover i{ display:inline-block;}
.pop_wrap .pop form .tjft .cont_wrap span.butn{display:inline-block; width:68px; height:68px; border:1px solid #dddddd; border-radius:3px; text-align:center; line-height:60px; font-size:40px; vertical-align:top; color:#999; background:#f5f5f5; cursor:pointer;}
.pop_wrap .pop .bottm{ padding:10px 0; text-align:center; border-top:1px solid #d6d6d6;}
.pop_wrap .pop .bottm button{ width:103px; height:28px; border:1px solid #c2c2c2; border-radius:3px; color:#666; margin:0 2px; background:#FFF; cursor:pointer;}
.pop_wrap .pop .bottm button:hover{ color:#ec6d3a;}
</style>
</head>

<body>
<div class="feedback">
	<div class="top">
		<img src="assets/img/feedback_top.jpg">
    </div>
    <ul class="main">
    	<li class="wldd"><a href="javascript:void(0)"><span class="icon"></span><p>网络订单</p></a></li>
        <li class="wlfx"><a href="javascript:void(0)"><span class="icon"></span><p>网络分销</p></a></li>
        <li class="pfh"><a href="javascript:void(0)"><span class="icon"></span><p>配发货</p></a></li>
        <li class="jxc"><a href="javascript:void(0)"><span class="icon"></span><p>进销存</p></a></li>
        <li class="cw"><a href="javascript:void(0)"><span class="icon"></span><p>财务</p></a></li>
        <li class="yy"><a href="javascript:void(0)"><span class="icon"></span><p>运营</p></a></li>
        <li class="bb"><a href="javascript:void(0)"><span class="icon"></span><p>报表</p></a></li>
        <li class="sp"><a href="javascript:void(0)"><span class="icon"></span><p>商品</p></a></li>
        <li class="jcsj"><a href="javascript:void(0)"><span class="icon"></span><p>基础数据</p></a></li>
        <li class="xtgl"><a href="javascript:void(0)"><span class="icon"></span><p>系统管理</p></a></li>
        <li class="xtjc"><a href="javascript:void(0)"><span class="icon"></span><p>系统集成</p></a></li>
        <li class="jy"><a href="javascript:void(0)"><span class="icon"></span><p>其他建议</p></a></li>
    </ul>
</div>
<div class="pop_wrap">
    <div class="pop">
    	<p class="title"><span>网络订单</span><i>&times;</i></p>
        <form>
            <!--p class="kjfk"><label>快捷反馈</label><select><option>1</option><option>2</option></select></p-->
            <p class="kjfk"><label>您的邮箱</label><input type="text" value="<?php echo $response['xqsue_email'];?>" id="xqsue_email"/></p>
            <p class="kjfk"><label>反馈标题</label><input type="text" id="xqsue_title"/></p>
            <p class="fkyj"><label>反馈意见</label><textarea id="xqsue_detail"></textarea></p>
            <p class="tjft"><label>添加附图</label><span class="cont_wrap"><span class="butn">+</span></span></p>
            <input id="upfile" name='upfile' type='file' style="display:none " onchange="upfilechange(this);"/>
        </form>
        <p class="bottm"><button class="cancel">取 消</button><button id='sure_submit' class="sure">确 定</button></p>
    </div>
</div>
    <input type="hidden" id="kh_id" value="<?php echo $response['kh_id'] ?>"/>
    <input type="hidden" id="kh_name" value="<?php echo $response['kh_name'] ?>"/>
    <input  type="hidden" id="xqfk_img" value=""/>
<?php echo load_js('jquery-1.8.1.min.js',true);?>
<?php echo load_js('ajaxfileupload.js',true);?>
<script>
$(function(){
        $("#xqfk_img").val("");
        var user_code="<?php echo $response['user_code'] ?>";
        var user_name="<?php echo $response['user_name'] ?>";
        var auth_state="<?php echo $response['auth_state'] ?>";
        if(auth_state=="-1"){
            alert("客户授权验证不合法");
            var opened=window.open('about:blank','_self');
            opened.opener=null;
            opened.close();
        }
    
	$(".feedback .main li").click(function(){
            var tt=$(this).children("a").children("p").text();
            //$("#pro_dot_num").find("a").filter(".curr").attr("prodnum");
            $(this).children("a").addClass("curr").end().siblings().children("a").removeClass("curr");
            $(".pop_wrap").show();
            $(".pop_wrap .pop .title span").text(tt);
            
            /*$("#xqsue_title").focus(); 
            $("#xqsue_title").val("");*/
            $("#xqsue_title").val(tt);
            $("#xqsue_detail").focus(); 
	});
        
	$(".pop_wrap .pop .title i,.pop_wrap .pop .bottm .cancel").click(function(){
            $("#xqsue_title").val("");
            $("#xqsue_detail").val("");
            $("#xqfk_img").val("");
            $(".pop_wrap .pop form .tjft").html("<label>添加附图</label><span class='cont_wrap'><span class='butn'>+</span></span>");
            $(".pop_wrap .pop form .tjft .butn").click(function(){
                $("#upfile").click();
            });
            $(".pop_wrap").hide();
	});
        
        $(".pop_wrap .pop .bottm .sure").click(function(){
            $("sure_submit").attr("disabled", "disabled");
            //提交操作
            if($("#xqsue_title").val()==""){
                alert("标题不能为空");
                $("#xqsue_title").focus(); 
                return;
            }
            if($("#xqsue_detail").val()==""){
                alert("内容不能为空");
                $("#xqsue_detail").focus(); 
                return;
            }
           if($("#xqsue_email").val()!=""){
            if(!$("#xqsue_email").val().match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)){
              alert("邮箱格式不正确！请重新输入！");
                $("#xqsue_email").focus(); 
                return; 
        }
      }
            var url='<?php echo get_app_url('index/do_subxqfk_plug'); ?>';
            $.ajax({ type: 'POST', dataType: 'json',  
                url:url,
                data: {kh_id:$("#kh_id").val(),
                       cp_id:21,
                       email:$("#xqsue_email").val(),
                       user_code:user_code,
                       user_name:user_name,
                       md_name:$(".pop_wrap .pop .title span").text(),
                       title:$("#xqsue_title").val(),
                       detail:$("#xqsue_detail").val(),
                       file:$("#xqfk_img").val()}, 
                success: function(ret) {
                    var type = ret.status == 1 ? 'success' : 'error';
                    if (type == 'success') {
                        $("sure_submit").attr("disabled", false);
                        alert("提交成功！提单号："+ret.data);
                        $("#xqsue_title").val("");
                        $("#xqsue_detail").val("");
                        $("#xqfk_img").val("");
                        $(".pop_wrap .pop form .tjft").html("<label>添加附图</label><span class='cont_wrap'><span class='butn'>+</span></span>");
                        $(".pop_wrap .pop form .tjft .butn").click(function(){
                            $("#upfile").click();
                        });
                        $(".pop_wrap").hide();
                    } else {
                        $("sure_submit").attr("disabled", false);
                        alert("提交失败");
                    }
                }
            });
	});
        
	function del(){
            $(".pop_wrap .pop form .tjft .cont .del").click(function(){
                var arr = $.parseJSON($("#xqfk_img").val());
                var realPath = $(this).parent().children("img").attr("src");
                for (var i = 0 ; i < arr.length; i++) {
                    if (arr[i][0] == realPath) {
                        arr.splice(i, 1);
                        break;
                    }
                }
                $("#xqfk_img").val(JSON.stringify(arr));
                $(this).parent().remove();
            });	
	}
	del();	
        
	$(".pop_wrap .pop form .tjft .butn").click(function(){
            //绑定上传事件
            $("#upfile").click();
	});
				
});

//执行上传操作
function upfilechange(obj){
    var id = jQuery(obj).attr('id');
    var url = "?app_act=index/uploadxqfkimg";
    jQuery.ajaxFileUpload({
        url: url,
        secureuri: false,
        fileElementId: id,
        dataType: 'json',
        success: function(data,status){
            var type = data.status == 1 ? 'success' : 'error';
            if (type == 'success'){
                var sxqfk_img ="";
                if($("#xqfk_img").val()!=""){
                    sxqfk_img=$("#xqfk_img").val();
                }else{
                    sxqfk_img="[]";
                }
                var _path = $.parseJSON(data.data.path);
                var xqfk_imglist=$.parseJSON(sxqfk_img);
                xqfk_imglist.push(_path);
                $("#xqfk_img").val(JSON.stringify(xqfk_imglist));
                $(".pop_wrap .pop form .tjft .butn").before("<span class='cont'><img src='"+_path[0]+"' width='100%' height='100%'/><i class='del'></i></span>");
                //$("#kh_licence_img").val(data.data['imgpath']);
                //$("#kh_licence_imgMsg").html(""); 
                //[["2015/06/558a8086e0de8.jpg","20130127_124522.jpg"],["2015/06/558a808942f17.jpg","20130127_124523.jpg"]]
                $(".pop_wrap .pop form .tjft .cont .del").click(function(){
                    var arr = $.parseJSON($("#xqfk_img").val());
                    var realPath = $(this).parent().children("img").attr("src");
                    for (var i = 0 ; i < arr.length; i++) {
                        if (arr[i][0] == realPath) {
                            arr.splice(i, 1);
                            break;
                        }
                    }
                    $("#xqfk_img").val(JSON.stringify(arr));
                    $(this).parent().remove();
                });	
            }else{
                alert(data.message);
            }
        },
        error: function(data,status,e){
            
        }
    });
}
</script>
</body>
</html>
